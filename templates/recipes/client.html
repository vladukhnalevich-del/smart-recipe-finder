<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Recipe Finder - Клиент</title>

    <style>
        .buttons { margin: 20px 0; text-align: center; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; color: white; }
        .btn-get { background: #4CAF50; }
        .btn-post { background: #2196F3; }
        .btn-delete { background: #f44336; }
        label { display: block; margin-top: 15px; font-weight: bold; }
        input, textarea { width: 100%; padding: 8px; margin-top: 5px; border: 1px solid #ddd; box-sizing: border-box; font-size: 16px; }
        .result { margin-top: 20px; padding: 15px; background: #f9f9f9; border: 1px solid #ddd; border-radius: 4px; font-family: monospace; white-space: normal; word-wrap: break-word; }
    </style>
</head>
<body>
    <h1>Smart Recipe Finder</h1>
    <div class="buttons">
        <button class="btn btn-get" onclick="getRecipes()">Получить рецепты</button>
        <button class="btn btn-post" onclick="postRecipe()">Создать рецепт</button>
        <button class="btn btn-delete" onclick="deleteRecipe()">Удалить рецепт</button>
    </div>

    <div>
        <label>ID рецепта (для удаления):</label>
        <input type="text" id="recipeId" placeholder="Введите ID">
    </div>

    <div>
        <label>Название рецепта:</label>
        <input type="text" id="name" placeholder="Название рецепта">
    </div>

    <div>
        <label>Ингредиенты (через запятую):</label>
        <textarea id="ingredients" rows="3" placeholder="ингредиент1, ингредиент2"></textarea>
    </div>

    <div>
        <label>Инструкции:</label>
        <textarea id="instructions" rows="4" placeholder="Инструкции приготовления"></textarea>
    </div>

    <div>
        <label>Время готовки (минуты):</label>
        <input type="number" id="cooking_time" value="30" min="1" max="1000">
    </div>

    <div class="result" id="result">
        Нажмите кнопку для работы с API
    </div>

    <script>
        const API_URL = '/api/recipes/';

        async function getRecipes() {
            try {
                const response = await fetch(API_URL);
                const data = await response.json();
                document.getElementById('result').innerHTML = 'GET успешен:<br>' +
                    JSON.stringify(data, null, 2).replace(/\n/g, '<br>');
            } catch (error) {
                document.getElementById('result').innerHTML = 'Ошибка GET: ' + error;
            }
        }

        async function postRecipe() {
            const name = document.getElementById('name').value.trim();
            if (!name) {
                alert('Введите название рецепта');
                return;
            }

            const ingredients = document.getElementById('ingredients').value
                .split(',')
                .map(i => i.trim())
                .filter(i => i.length > 0);

            let cooking_time = document.getElementById('cooking_time').value.trim();
            if (cooking_time === '') cooking_time = 30;
            cooking_time = parseFloat(cooking_time);

            if (isNaN(cooking_time) || cooking_time <= 0) {
                alert('Время готовки должно быть положительным числом');
                return;
            }

            const recipeData = {
                name: name,
                ingredients: ingredients,
                instructions: document.getElementById('instructions').value.trim(),
                cooking_time: cooking_time
            };

            try {
                const response = await fetch(API_URL, {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(recipeData)
                });
                const data = await response.json();

                if (response.ok) {
                    document.getElementById('result').innerHTML = 'POST успешен:<br>' +
                        JSON.stringify(data, null, 2).replace(/\n/g, '<br>');
                    document.getElementById('name').value = '';
                    document.getElementById('ingredients').value = '';
                    document.getElementById('instructions').value = '';
                } else {
                    document.getElementById('result').innerHTML = 'Ошибка: ' + JSON.stringify(data);
                }
            } catch (error) {
                document.getElementById('result').innerHTML = 'Ошибка POST: ' + error;
            }
        }

        async function deleteRecipe() {
            const id = document.getElementById('recipeId').value.trim();
            if (!id) {
                alert('Введите ID рецепта для удаления');
                return;
            }

            if (!confirm('Удалить рецепт ' + id + '?')) return;

            try {
                const response = await fetch(API_URL + id + '/', {
                    method: 'DELETE'
                });
                const data = await response.json();

                if (response.ok) {
                    document.getElementById('result').innerHTML = 'DELETE успешен:<br>' +
                        JSON.stringify(data, null, 2).replace(/\n/g, '<br>');
                    document.getElementById('recipeId').value = '';
                } else {
                    document.getElementById('result').innerHTML = 'Ошибка: ' + JSON.stringify(data);
                }
            } catch (error) {
                document.getElementById('result').innerHTML = 'Ошибка DELETE: ' + error;
            }
        }

        window.onload = getRecipes;
    </script>
</body>
</html>